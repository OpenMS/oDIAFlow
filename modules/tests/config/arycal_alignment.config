// Test configuration for ARYCAL module
// Override default parameters for testing with test data

params {
  arycal {
    // XIC settings
    xic_include_precursor = false  // MS2 only for test
    xic_num_isotopes = 3
    xic_file_type = 'sqMass'           // Auto-detect sqMass
    
    // Features settings
    features_file_type = 'osw'      // Auto-detect OSW
    
    // Filters - relaxed for test data
    include_decoys = false
    include_identifying_transitions = false
    max_score_ms2_qvalue = 1.0     // Accept all for test
    precursor_ids = null
    
    // Alignment settings
    batch_size = 500               // Smaller batch for test
    alignment_method = "fftdtw"    // Fast Fourier Transform DTW
    reference_type = "star"        // Star alignment (all-vs-best)
    reference_run = null           // Auto-select reference
    use_tic = true
    
    // Smoothing parameters - lighter for test
    sgolay_window = 7              // Smaller window for test
    sgolay_order = 2               // Lower order for test
    
    // RT mapping
    rt_mapping_tolerance = 15.0    // More relaxed for test
    decoy_peak_mapping_method = "shuffle"
    decoy_window_size = 30
    
    // Output options
    compute_scores = true          // Generate alignment scores
    scores_output_file = null
    retain_alignment_path = false
    
    // Runtime
    log_level = "info"
  }
}

process {
  withName: ARYCAL {
    cpus = 4
    memory = '8.GB'
    time = '1.h'
    containerOptions = '--env HOME=/tmp --env MPLCONFIGDIR=/tmp/matplotlib --env DUCKDB_HOME=/tmp/duckdb'
  }
}

profiles {
  docker {
    docker.enabled = true
    docker.runOptions = '-u $(id -u):$(id -g) --env HOME=/tmp --env MPLCONFIGDIR=/tmp/matplotlib --env DUCKDB_HOME=/tmp/duckdb'
    singularity.enabled = false
  }
  
  singularity {
    singularity.enabled = true
    singularity.autoMounts = true
    docker.enabled = false
  }
}
