/*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    oDIAFlow Execution Profiles
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Profiles for different execution environments. Combine profiles as needed:
    
    Examples:
        nextflow run main.nf -profile docker,local
        nextflow run main.nf -profile singularity,slurm
        nextflow run main.nf -profile docker,local,test
----------------------------------------------------------------------------------------
*/

profiles {
    // =========================================================================
    // CONTAINER ENGINES
    // =========================================================================
    
    docker {
        docker.enabled         = true
        docker.userEmulation   = true
        docker.runOptions      = '-u $(id -u):$(id -g)'
        singularity.enabled    = false
        podman.enabled         = false
        shifter.enabled        = false
        charliecloud.enabled   = false
        apptainer.enabled      = false
    }

    singularity {
        singularity.enabled    = true
        singularity.autoMounts = true
        docker.enabled         = false
        podman.enabled         = false
        shifter.enabled        = false
        charliecloud.enabled   = false
        apptainer.enabled      = false
    }

    apptainer {
        apptainer.enabled      = true
        apptainer.autoMounts   = true
        docker.enabled         = false
        singularity.enabled    = false
        podman.enabled         = false
        shifter.enabled        = false
        charliecloud.enabled   = false
    }

    podman {
        podman.enabled         = true
        docker.enabled         = false
        singularity.enabled    = false
        shifter.enabled        = false
        charliecloud.enabled   = false
        apptainer.enabled      = false
    }

    // =========================================================================
    // EXECUTION ENVIRONMENTS
    // =========================================================================
    
    // Local execution (workstation)
    local {
        executor.name          = 'local'
        executor.cpus          = Runtime.runtime.availableProcessors()
        executor.memory        = '64 GB'  // Adjust based on your system
        includeConfig 'resources/local.config'
    }

    // HPC with SLURM scheduler
    slurm {
        executor.name          = 'slurm'
        executor.queueSize     = 50
        executor.submitRateLimit = '10/1min'
        process.executor       = 'slurm'
        // Uncomment and adjust for your cluster:
        // process.queue       = 'normal'
        // process.clusterOptions = '--account=myaccount'
        includeConfig 'resources/hpc.config'
    }

    // HPC with PBS/Torque scheduler
    pbs {
        executor.name          = 'pbs'
        executor.queueSize     = 50
        process.executor       = 'pbs'
        // Uncomment and adjust for your cluster:
        // process.queue       = 'batch'
        includeConfig 'resources/hpc.config'
    }

    // HPC with LSF scheduler
    lsf {
        executor.name          = 'lsf'
        executor.queueSize     = 50
        process.executor       = 'lsf'
        // Uncomment and adjust for your cluster:
        // process.queue       = 'normal'
        includeConfig 'resources/hpc.config'
    }

    // HPC with SGE scheduler
    sge {
        executor.name          = 'sge'
        executor.queueSize     = 50
        process.executor       = 'sge'
        // Uncomment and adjust for your cluster:
        // process.queue       = 'all.q'
        // process.penv        = 'smp'
        includeConfig 'resources/hpc.config'
    }

    // =========================================================================
    // CLOUD PLATFORMS
    // =========================================================================
    
    // AWS Batch
    awsbatch {
        process.executor       = 'awsbatch'
        process.queue          = 'your-batch-queue'
        aws.region             = 'us-east-1'
        aws.batch.cliPath      = '/home/ec2-user/miniconda/bin/aws'
        includeConfig 'resources/hpc.config'
    }

    // Google Cloud Batch
    googlebatch {
        process.executor       = 'google-batch'
        google.location        = 'us-central1'
        google.region          = 'us-central1'
        google.project         = 'your-project-id'
        includeConfig 'resources/hpc.config'
    }

    // Azure Batch
    azurebatch {
        process.executor       = 'azurebatch'
        azure.batch.location   = 'westus2'
        azure.batch.accountName = 'your-batch-account'
        includeConfig 'resources/hpc.config'
    }

    // =========================================================================
    // SPECIAL MODES
    // =========================================================================
    
    // Test profile with minimal resources
    test {
        params.max_cpus   = 4
        params.max_memory = '16.GB'
        params.max_time   = '2.h'
        includeConfig 'test/test.config'
    }

    // Debug mode with verbose output
    debug {
        process.beforeScript   = 'echo "Starting: $HOSTNAME"'
        process.afterScript    = 'echo "Finished: $HOSTNAME"'
        cleanup                = false
        params.save_intermediates = true
        params.save_logs       = true
    }

    // Retry failed jobs with more resources
    retry {
        process.errorStrategy  = 'retry'
        process.maxRetries     = 3
    }

    // Stub run (dry run without executing)
    stub {
        process.executor       = 'local'
        // Enable stub runs in processes that support it
    }
}
