/*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    oDIAFlow Local Execution Resource Configuration
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Resource settings optimized for local workstations with moderate resources.
    Suitable for development, testing, and small-scale analyses.
    
    Usage: nextflow run main.nf -profile docker,local
----------------------------------------------------------------------------------------
*/

process {
    // Default resources for local execution
    cpus   = { 4 * task.attempt }
    memory = { 16.GB * task.attempt }
    time   = { 4.h * task.attempt }

    // -------------------------------------------------------------------------
    // SAGE Search
    // -------------------------------------------------------------------------
    withName: '.*SAGE_SEARCH.*' {
        cpus   = { 8 * task.attempt }
        memory = { 32.GB * task.attempt }
        time   = { 4.h * task.attempt }
    }

    withName: '.*SAGE_COMBINE_RESULTS' {
        cpus   = 2
        memory = { 8.GB * task.attempt }
        time   = { 1.h * task.attempt }
    }

    // -------------------------------------------------------------------------
    // EasyPQP
    // -------------------------------------------------------------------------
    withName: '.*EASYPQP_CONVERTSAGE' {
        cpus   = 4
        memory = { 16.GB * task.attempt }
        time   = { 2.h * task.attempt }
    }

    withName: '.*EASYPQP_LIBRARY' {
        cpus   = 2
        memory = { 16.GB * task.attempt }
        time   = { 2.h * task.attempt }
    }

    withName: '.*EASYPQP_REDUCE' {
        cpus   = 1
        memory = { 4.GB * task.attempt }
        time   = { 30.m * task.attempt }
    }

    // -------------------------------------------------------------------------
    // OpenSWATH Tools
    // -------------------------------------------------------------------------
    withName: '.*OPENSWATHASSAYGENERATOR' {
        cpus   = 2
        memory = { 8.GB * task.attempt }
        time   = { 30.m * task.attempt }
    }

    withName: '.*OPENSWATHDECOYGENERATOR' {
        cpus   = 2
        memory = { 8.GB * task.attempt }
        time   = { 30.m * task.attempt }
    }

    withName: '.*OPENSWATHWORKFLOW' {
        cpus   = { 10 * task.attempt }
        memory = { 64.GB * task.attempt }
        time   = { 6.h * task.attempt }
        maxForks = 1  // Limit parallel jobs on local machine
    }

    // -------------------------------------------------------------------------
    // PyProphet
    // -------------------------------------------------------------------------
    withName: '.*PYPROPHET_MERGE' {
        cpus   = 2
        memory = { 8.GB * task.attempt }
        time   = { 30.m * task.attempt }
    }

    withName: '.*PYPROPHET_PEAKGROUP_SCORING' {
        cpus   = 4
        memory = { 16.GB * task.attempt }
        time   = { 2.h * task.attempt }
    }

    withName: '.*PYPROPHET_ALIGNMENT_SCORING' {
        cpus   = 4
        memory = { 16.GB * task.attempt }
        time   = { 1.h * task.attempt }
    }

    withName: '.*PYPROPHET_INFER_PEPTIDE' {
        cpus   = 2
        memory = { 8.GB * task.attempt }
        time   = { 1.h * task.attempt }
    }

    withName: '.*PYPROPHET_INFER_PROTEIN' {
        cpus   = 2
        memory = { 8.GB * task.attempt }
        time   = { 1.h * task.attempt }
    }

    withName: '.*PYPROPHET_EXPORT_TSV' {
        cpus   = 2
        memory = { 8.GB * task.attempt }
        time   = { 1.h * task.attempt }
    }

    withName: '.*PYPROPHET_CALIBRATION_REPORT' {
        cpus   = 4
        memory = { 32.GB * task.attempt }
        time   = { 2.h * task.attempt }
    }

    // -------------------------------------------------------------------------
    // Arycal
    // -------------------------------------------------------------------------
    withName: '.*ARYCAL' {
        cpus   = { 8 * task.attempt }
        memory = { 64.GB * task.attempt }
        time   = { 8.h * task.attempt }
    }

    // -------------------------------------------------------------------------
    // File Conversion
    // -------------------------------------------------------------------------
    withName: '.*DIAPYSEF_TDF_TO_MZML' {
        cpus   = 2
        memory = { 8.GB * task.attempt }
        time   = { 2.h * task.attempt }
    }
}
