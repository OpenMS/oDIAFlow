/*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    oDIAFlow HPC Cluster Resource Configuration
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    Resource settings optimized for high-performance computing clusters.
    Suitable for large-scale production analyses.
    
    Usage: nextflow run main.nf -profile singularity,slurm -c conf/resources/hpc.config
    
    Note: Adjust maxForks and queue settings based on your cluster policies.
----------------------------------------------------------------------------------------
*/

process {
    // Default resources for HPC execution
    cpus   = { 8 * task.attempt }
    memory = { 32.GB * task.attempt }
    time   = { 8.h * task.attempt }

    // -------------------------------------------------------------------------
    // SAGE Search
    // -------------------------------------------------------------------------
    withName: '.*SAGE_SEARCH.*' {
        cpus   = { 32 * task.attempt }
        memory = { 128.GB * task.attempt }
        time   = { 6.h * task.attempt }
    }

    withName: '.*SAGE_COMBINE_RESULTS' {
        cpus   = 4
        memory = { 16.GB * task.attempt }
        time   = { 2.h * task.attempt }
    }

    // -------------------------------------------------------------------------
    // EasyPQP
    // -------------------------------------------------------------------------
    withName: '.*EASYPQP_CONVERTSAGE' {
        cpus   = 8
        memory = { 32.GB * task.attempt }
        time   = { 4.h * task.attempt }
    }

    withName: '.*EASYPQP_LIBRARY' {
        cpus   = 4
        memory = { 32.GB * task.attempt }
        time   = { 4.h * task.attempt }
    }

    withName: '.*EASYPQP_REDUCE' {
        cpus   = 2
        memory = { 8.GB * task.attempt }
        time   = { 1.h * task.attempt }
    }

    // -------------------------------------------------------------------------
    // OpenSWATH Tools
    // -------------------------------------------------------------------------
    withName: '.*OPENSWATHASSAYGENERATOR' {
        cpus   = 4
        memory = { 16.GB * task.attempt }
        time   = { 1.h * task.attempt }
    }

    withName: '.*OPENSWATHDECOYGENERATOR' {
        cpus   = 4
        memory = { 16.GB * task.attempt }
        time   = { 1.h * task.attempt }
    }

    withName: '.*OPENSWATHWORKFLOW' {
        cpus   = { 64 * task.attempt }
        memory = { 120.GB * task.attempt }
        time   = { 8.h * task.attempt }
        maxForks = 4  // Adjust based on cluster capacity
    }

    // -------------------------------------------------------------------------
    // PyProphet
    // -------------------------------------------------------------------------
    withName: '.*PYPROPHET_MERGE' {
        cpus   = 4
        memory = { 16.GB * task.attempt }
        time   = { 1.h * task.attempt }
    }

    withName: '.*PYPROPHET_PEAKGROUP_SCORING' {
        cpus   = 8
        memory = { 64.GB * task.attempt }
        time   = { 4.h * task.attempt }
    }

    withName: '.*PYPROPHET_ALIGNMENT_SCORING' {
        cpus   = 8
        memory = { 32.GB * task.attempt }
        time   = { 2.h * task.attempt }
    }

    withName: '.*PYPROPHET_INFER_PEPTIDE' {
        cpus   = 4
        memory = { 32.GB * task.attempt }
        time   = { 2.h * task.attempt }
    }

    withName: '.*PYPROPHET_INFER_PROTEIN' {
        cpus   = 4
        memory = { 32.GB * task.attempt }
        time   = { 2.h * task.attempt }
    }

    withName: '.*PYPROPHET_EXPORT_TSV' {
        cpus   = 4
        memory = { 16.GB * task.attempt }
        time   = { 2.h * task.attempt }
    }

    withName: '.*PYPROPHET_CALIBRATION_REPORT' {
        cpus   = 8
        memory = { 128.GB * task.attempt }
        time   = { 4.h * task.attempt }
    }

    // -------------------------------------------------------------------------
    // Arycal
    // -------------------------------------------------------------------------
    withName: '.*ARYCAL' {
        cpus   = { 64 * task.attempt }
        memory = { 128.GB * task.attempt }
        time   = { 8.h * task.attempt }
    }

    // -------------------------------------------------------------------------
    // File Conversion
    // -------------------------------------------------------------------------
    withName: '.*DIAPYSEF_TDF_TO_MZML' {
        cpus   = 4
        memory = { 16.GB * task.attempt }
        time   = { 2.h * task.attempt }
    }
}
